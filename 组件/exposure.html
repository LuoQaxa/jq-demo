<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>曝光加载组件</title>
	<style>

		ul,li,body{
			margin:0;
			padding: 0;
		}
		li {
			list-style: none;
		}
		.container {
			width: 800px;
			margin: 0 auto;
		}
		li {
			float: left;
			margin:10px 10px;
		}
		.clearfix:after {
			content: '';
			display: block;
			clear: both;
		}
		img {
			width: 220px;
			height: 400px;
		}

	</style>
</head>
<body>
	<ul class="container clearfix">
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" alt=""></a></li>
		
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/17.jpg" alt=""></a></li>
		<li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg"  data-src="http://cdn.jirengu.com/book.jirengu.com/img/18.jpg" alt=""></a></li>
		
	</ul>
	<p id="hi">hello exporuse</p>
	<script src="https://code.jquery.com/jquery-3.1.0.js"></script>
	<script>

	function Exposure($target,callback){
		this.$target = $target;
		this.callback = callback;
		this.bind();
		this.select();
	}
	Exposure.prototype.bind = function(){
		var _this = this;
		$(window).on('scroll',function(){
			_this.select();
		})
	}
	Exposure.prototype.select = function(){
		if (this.isVisible(this.$target)) {
			this.callback(this.$target);
		}
	}

	Exposure.prototype.isVisible = function(){
		var winHe = $(window).height();
		var scrollTop = $(window).scrollTop();
		var offsetTop = this.$target.offset().top;
		var height = this.$target.innerHeight();
		if ( (winHe + scrollTop ) > offsetTop && (scrollTop < offsetTop + height) ) {
			return true;
		}else {
			return false;
		}
	}

	//使用范例，当元素曝光时执行回调函数
	// new Exposure($('#hi'),function(){
	// 	setTimeout(function(){
	// 		$('#hi').css('backgroundColor','red');
	// 	},4000)
		
	// })

	//实现图片懒加载,由于我们处理的都是单个元素，所以可以对每一张图片都new一个对象
	// $('.container img').each(function(idx,img){
	// 	new Exposure($(img),function($img){	
	// 		var url = $img.attr('data-src')
	// 		$img.attr('src',url);
	// 	})
	// })

	var Lazy = (function(){
		var isload = false;
		return {
			init:function($targets,callback) {
				$targets.each(function(idx,target){
					new Exposure($(target),callback);
				})
			},
			//由于有些需要每次加载都执行回调，而像图片加载就只需要执行一次。
			one:function($targets,callback){
			}
		}
	})()

	Lazy.init($('#hi'),function($node){
		$node.text($node.text() + 'world');
	})
	Lazy.init($('.container img'),function($node){
		var url = $node.attr('data-src')
		$node.attr('src',url);
	})
	

		// //优化一、每次都要查找一遍所有的图片，可以对已经加载的图片做个标识，然后在筛选
		// select();
		// //这个函数是检查哪些图片是能够看到的，并将它显示出来
		// function select(){
		// 	$('.container img').not('.isloaded').each(function(){
		// 			if (isVisible($(this))) {
		// 				showImg($(this));
		// 			}
		// 	})
		// }
		
		// $(window).on('scroll',function(){
		// 	//滚动之后就要检查一下元素是否能够被看见，如果能够看见就展示图片
		// 	select();
		// })
		// //当某个元素能够被看见的时候加载，这个函数解决了元素什么时候加载
		// function isVisible($node) {
		// 	var winHe = $(window).height();
		// 	var scrollTop = $(window).scrollTop();
		// 	var offsetTop = $node.offset().top;
		// 	var height = $node.innerHeight();
		// 	if ( (winHe + scrollTop ) > offsetTop && (scrollTop < offsetTop + height) ) {
		// 		return true;
		// 	}else {
		// 		return false;
		// 	}
		// }
		// //接下来加载图片的函数，img图片的src属性如果是空就不会加载图片，如果设置后就会加载，所以应该先把所有的img图片的src属性清除掉
		// function showImg($imgs){
		// 	//对哪些img标签添加呢？首先不考虑性能只实现功能
		// 	$imgs.each(function(){
		// 		var url = $(this).attr('data-src')
		// 		$(this).attr('src',url);
		// 		$(this).addClass('isloaded');
		// 	})
			
		// }

	</script>
</body>
</html>
